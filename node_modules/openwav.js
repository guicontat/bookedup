function openEntireWav(dirname, callback) {

	var fs = require('fs');
	var wav = require('wav');
	var audioFormat;
	var numChannels;
	var sampleRate;
	var byteRate;
	var blockAlign;
	var bitPerSample;
	var subChunk2Size;
	var chunkSize;
	var subChunk1size;
	var reader 			= new wav.Reader(); 
	var input 			= fs.createReadStream(dirname);

	input.pipe(reader);

	reader.once('readable', function () {

		chunkSize = Number(reader.chunkSize);
		subChunk1size = reader.subChunk1size;
		if(typeof subChunk1size === 'undefined')
			subChunk1size = 16;
		audioFormat 	= reader.audioFormat;
		numChannels 	= reader.channels;
		sampleRate 		= reader.sampleRate;
		
		byteRate 		= reader.byteRate;
		blockAlign 		= reader.blockAlign;
		bitPerSample 	= reader.bitDepth;
		subChunk2Size	= reader.subChunk2Size; 

		if(subChunk2Size == null)
			subChunk2Size = 0;

		fs.open(dirname, 'r', function(status, fd) {
			
			var buffer = new Buffer(chunkSize);
			fs.read(fd, buffer, 0, buffer.length, 0, function(err, num) {
				var array = [buffer, chunkSize, subChunk1size, audioFormat, numChannels, sampleRate, byteRate, blockAlign, bitPerSample, subChunk2Size];
				callback(status, array)
			});
		});
	});
}

function getHeader(dirname, callback) {

	var fs = require('fs');
	var wav = require('wav');
	var audioFormat;
	var numChannels;
	var sampleRate;
	var byteRate;
	var blockAlign;
	var bitPerSample;
	var subChunk2Size;
	var chunkSize;
	var subChunk1size;
	var reader 			= new wav.Reader(); 
	var input 			= fs.createReadStream(dirname);

	input.pipe(reader);

	reader.once('readable', function () {

		chunkSize = Number(reader.chunkSize);
		subChunk1size = reader.subChunk1size;
		if(typeof subChunk1size === 'undefined')
			subChunk1size = 16;
		audioFormat 	= reader.audioFormat;
		numChannels 	= reader.channels;
		sampleRate 		= reader.sampleRate;
		
		byteRate 		= reader.byteRate;
		blockAlign 		= reader.blockAlign;
		bitPerSample 	= reader.bitDepth;
		subChunk2Size	= reader.subChunk2Size; 

		if(subChunk2Size == null)
			subChunk2Size = 0;

		fs.open(dirname, 'r', function(status, fd) {
			
			var buffer = new Buffer(chunkSize);
			fs.read(fd, buffer, 0, buffer.length, 0, function(err, num) {
				var array = [chunkSize, subChunk1size, audioFormat, numChannels, sampleRate, byteRate, blockAlign, bitPerSample, subChunk2Size];
				callback(status, array)
			});
		});
	});
}

function getData(dirname, offset, pos_start, pos_end, callback) {
	var fs = require('fs');
	var wav = require('wav');

	var reader 			= new wav.Reader(); 
	var input 			= fs.createReadStream(dirname);

	input.pipe(reader);
	reader.once('readable', function () {

		chunkSize = Number(reader.chunkSize);
		if(pos_end < chunkSize)
		{
			fs.open(dirname, 'r', function(status, fd) {
				
				var buffer = new Buffer(pos_end-pos_start);
				fs.read(fd, buffer, offset, pos_end-pos_start, pos_start, function(err, num) {
					var float32 = new Float32Array(buffer.length/2);
					for (i = 0; i < buffer.length; i++) {
        				float32[i] = buffer[i*2]/255*2-1;
    				}
    				var array = [float32, float32.length];
					callback(status, array);
				});
			});
		}
	});
}

exports.openEntireWav = openEntireWav;
exports.getData = getData;
exports.getHeader = getHeader;
